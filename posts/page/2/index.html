<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Posts | Beoning</title>
<meta name=keywords content>
<meta name=description content="Posts - Beoning">
<meta name=author content="Max">
<link rel=canonical href=https://www.soundpill.cn/posts/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<link rel=preload href=https://s2.loli.net/2022/01/17/bnDIUk5RZhK2CgY.png as=image>
<link rel=icon href=https://www.soundpill.cn/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=16x16 href=https://www.soundpill.cn/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://www.soundpill.cn/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://www.soundpill.cn/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://www.soundpill.cn/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<link rel=alternate type=application/rss+xml href=https://www.soundpill.cn/posts/index.xml>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Posts">
<meta property="og:description" content="我的个人博客">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.soundpill.cn/posts/"><meta property="og:image" content="https://www.soundpill.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="Beoning">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://www.soundpill.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Posts">
<meta name=twitter:description content="我的个人博客">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.soundpill.cn/posts/"}]}</script>
</head>
<body class=list id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.soundpill.cn/ accesskey=h title="Beoning (Alt + H)">
<img src=https://s2.loli.net/2022/01/17/bnDIUk5RZhK2CgY.png alt=logo aria-label=logo height=35>Beoning</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
</ul>
</nav>
</header>
<main class=main>
<header class=page-header><div class=breadcrumbs><a href=https://www.soundpill.cn/>Home</a></div>
<h1>Posts</h1>
</header>
<article class=post-entry>
<header class=entry-header>
<h2>i++是原子操作吗?
</h2>
</header>
<section class=entry-content>
<p>i++ 是原子操作吗? 不是, i++ 要完成的操作要先读取变量 i 的值, 对这个值加 1, 再把结果保存到 i 中. 所以不是原子操作.
我们来看下面的代码
这段代码是启动 10 个线程, 每个线程对 count 执行 10 万次自增操作, 直观上来看最后 count 的结果是 100 万, 但因为自增操作不是原子性的, 所以最终的结果每次都会不一样, 会有协程做重复操作. 那应该怎么解决这个问题呢? 并发资源的读取问题最直接的解决方法就是加锁. 改良后如下:</p>
</section>
<footer class=entry-footer><span title="2021-01-17 09:47:29 +0800 CST">January 17, 2021</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to i++是原子操作吗?" href=https://www.soundpill.cn/posts/2021-01-17-iplusplus/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Gerrit概念说明及使用
</h2>
</header>
<section class=entry-content>
<p>Gerrit介绍 Gerrit简介 Gerrit, 一种开放源代码的代码审查软件, 使用网页界面. 利用网页浏览器, 同一个团队的软件开发者, 可以相互审阅彼此修改后的代码, 决定是否能够提交, 回退或是继续修改. 它使用版本控制系统Git作为底层.
它分支自Rietveld, 作者为Google公司的Shawn Pearce, 原先是为了管理Android项目而产生. 这个软件的名称, 来自于荷兰家具设计师赫里特·里特费尔德(Gerrit Rietveld).
因为对访问控制表(ACL)相关的修正, 没有被集成进Rietveld, 之后Gerrit就由Rietveld分支出来, 形成独立软件项目.
最早它是由Python写成, 在第二版后, 改成用Java与SQL. 使用Google Web Toolkit来产生前端的JavaScript.
为什么需要Gerrit 首先, 代码审查可以帮助程序员了解系统功能, 从整体掌控代码质量, 其次, 通过代码审核可以及时止损, 构建更加健壮的系统代码.
代码审核的建议(来自程序员客栈) 对事不对人, 大家都是同事, 在一个团队工作和气最重要. 不要在Code Review中说"你写的什么垃圾"这种话, 你可以说"这个变量名不是很好理解, 咱们换成xxx是不是更好"
每个Review至少给一条正面评价. Gerrit中有对代码点赞的功能, 可以时不时的使用一下.
保证发布的代码和评审意见的可读性.
用工具进行基础问题的自动化检查. 用Tab还是空格, 用两个空格还是四个空格, 缩进风格是使用K&R还是Allman. 这些问题可以使用php code sniffer解决, 团队应该把精力放在代码规范, 代码性能优化等地方.
全员参加Code Review, 并设定各部分负责人.
每个代码PR(Pull Request)内容一定要少....</p>
</section>
<footer class=entry-footer><span title="2020-09-23 18:35:52 +0800 CST">September 23, 2020</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to Gerrit概念说明及使用" href=https://www.soundpill.cn/posts/2020-09-23-gerrit-desc/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>为什么没有使用索引?
</h2>
</header>
<section class=entry-content>
<p>为什么没有用索引? 已知表 a 数据总量是 40w, 根据时间范围过滤出最近 7 天的数据, 语句如下:
explain SELECT `question_id`, `student_id`, `teacher_id`, `question_type`, `question_step`, `question_no`, `level`, `class_id`, `lesson_id`, `teacher_get_at`, `teacher_set_at`, `status`, `teacher_from`, `wrong_reason_id`, `created_at`, `submit_time` FROM `answer_records` WHERE `updated_at` BETWEEN '2020-07-14+00:00:00' AND '2020-07-21+00:00:00' ORDER BY `created_at` DESC; 从 explain 返回的数据来看, 这条语句并没有使用到索引, 而且 mysql 进行了全表的扫描, 这个原因就是我们要查询的数据太多了.
因为 innodb 引擎会在检索索引后进行回表的操作, mysql 觉得你查询的数据这么多, 我一个个回表的这点时间都可以把全表扫一次了, 我就没必要用索引再去回表了, 所以就会导致这个索引没有用到.
那我们就想用索引, 应该怎么办呢?
FROM `answer_records` FORCE INDEX(rqx) 在业务层面的话, 如果时间范围比较大, 可以分批次查询, 这样就会快一点, 如果是频繁需要此类操作的话, 还是建议将时间戳提早设计进表结构里, 通过 int 类型的时间戳进行范围查找和排序会事半功倍</p>
</section>
<footer class=entry-footer><span title="2020-09-23 11:41:43 +0800 CST">September 23, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to 为什么没有使用索引?" href=https://www.soundpill.cn/posts/2020-09-23-why-index-unuse/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>在图片上添加文字或图片
</h2>
</header>
<section class=entry-content>
<p>intervention/image 这是一个第三方扩展, 用来处理图片的, 功能特别强大, 可以 cover 我们这篇文章提到的需求
安装文档: http://image.intervention.io/getting_started/installation
我们首先在项目中引入这个包:
$ composer require intervention/image 其次, laravel 中需要发布配置文件:
php artisan vendor:publish --provider="Intervention\Image\ImageServiceProviderLaravel5" lumen 中需要修改 bootstrap.php, 在当中手动注册
$app->register(\Intervention\Image\ImageServiceProviderLumen::class); 该扩展默认使用的是 GD 库, 如果你想用 Imagick 扩展需要修改文件, config/image.php
&lt;?php return [ 'driver' => 'imagick' ]; 如果你不想要每次 use 都使用全路径, 可以按照官方所述将 Image 关键字写入 alias 中
Laravel: config/app.php $providers: Intervention\Image\ImageServiceProvider::class $aliases: 'Image' => Intervention\Image\Facades\Image::class Lumen: bootstrap/app.php $app->withAliases(array('Intervention\Image\Facades\Image' => 'Image')); 具体使用 use Image; public function deal() { $image = Image::make(public_path() ....</p>
</section>
<footer class=entry-footer><span title="2020-01-10 15:43:41 +0800 CST">January 10, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to 在图片上添加文字或图片" href=https://www.soundpill.cn/posts/2020-01-10-draw-someting-on-picture/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>比较两个字符串是否相等
</h2>
</header>
<section class=entry-content>
<p>有时候, 当用户传入一个字符串时, 你可能会需要拿着这个字符串和最终结果相对比, 如果我们使用 == 号来比较两个字符串, 可能会产生时序攻击.
'abcdef' == $req->code 也就是说, == 号在判断两个字符串相等时, 会一位一位的判断, 如果遇到哪一位不一样, 就返回错误, 这样根据服务器运算速度, 就可以一位一位的猜出最终的结果.
php 官方提供了避免时序攻击的字符串比较函数, 就是 hash_equals 无论两个字符串是否相等, 本函数的时间消耗是恒定的.
文档如下: https://www.php.net/manual/zh/function.hash-equals.php</p>
</section>
<footer class=entry-footer><span title="2020-01-10 15:34:56 +0800 CST">January 10, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to 比较两个字符串是否相等" href=https://www.soundpill.cn/posts/2020-01-10-compare-two-string-equal/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Homestead完整的切换php版本
</h2>
</header>
<section class=entry-content>
<p>相信大多数人搜到的都是这篇文章 https://learnku.com/articles/16881
文章中说, 使用 homestead 自带的工具 update-alternatives 进行切换就可以了, 但是我在使用后 php 的版本是切换了, 但是 pecl 安装扩展的时候安装的还是20170817目录, 这是 php7.2 的扩展包默认目录, 使用 php-config 看的时候也是 php7.2
如何把phpize, pecl, php-config 都切换为 php7.1 呢? 请看下面
sudo update-alternatives --set php /usr/bin/php7.1 sudo update-alternatives --set phar /usr/bin/phar7.1 sudo update-alternatives --set phar.phar /usr/bin/phar.phar7.1 sudo update-alternatives --set phpize /usr/bin/phpize7.1 sudo update-alternatives --set php-config /usr/bin/php-config7.1 如果你在切换之前装了错误的扩展包到其他版本的目录下, 这样切换完之后卸载重新装, 就 ok 了</p>
</section>
<footer class=entry-footer><span title="2020-01-10 15:14:46 +0800 CST">January 10, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to Homestead完整的切换php版本" href=https://www.soundpill.cn/posts/2020-01-10-homestead-version-switch/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>mojave下使用pyenv安装python3出错的问题
</h2>
</header>
<section class=entry-content>
<p>使用pyenv安装python3时出现如下报错 按照提示来看,好像是在提示我没有安装zlib库,但是我已经装了,没办法,google一下吧. (如果你因为没有安装zlib库而产生这个问题, 那就好办了, 直接brew install zlib)
google搜索到的解决方案大都是要安装xcode命令行工具 xcode-select --install 这个我也安装了, 不安装的话啥也干不了啊
最后解决方案 查看一下xcode-select -v的版本 这个版本的xcode-select 在默认情况下不包含Mojave SDK的头文件的,需要手动安装,mojave采用了新的SDK,关于新SDK的解释,官方的文档在这里 https://developer.apple.com/macos/whats-new/
接下来,我手动安装了新的SDK头文件,解决完毕
sudo installer -pkg /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg -target / </p>
</section>
<footer class=entry-footer><span title="2019-02-26 15:33:39 +0800 CST">February 26, 2019</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to mojave下使用pyenv安装python3出错的问题" href=https://www.soundpill.cn/posts/2019-02-26-mojave%E4%B8%8B%E4%BD%BF%E7%94%A8pyenv%E5%AE%89%E8%A3%85python3%E5%87%BA%E9%94%99%E7%9A%84%E9%97%AE%E9%A2%98/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>redis中的SDS数据结构
</h2>
</header>
<section class=entry-content>
<p>SDS(Simple Dynamic String)简单动态字符串 在Redis中可修改的字符串值都是采用的SDS数据结构, 而不可修改的都采用了C字符串
SDS的结构 有三个基本变量
free 纪录buf数组中未使用字节的数量 len 纪录buf数组中已使用字节的数量, 等于SDS所保存字符串的长度 buf 字节数组, 用于保存字符串(二进制) 为什么采用SDS SDS是基于C字符串结构的缺点优化后的产物, 因为采用C字符串的方式会有以下一些问题：
获取字符串长度需要遍历字符串获取, 将需要O(N)的时间复杂度 C字符串会有缓冲区溢出的问题 一旦修改字符串操作发生就会重新分配内存, 修改N次就分配N次 所以, 基于以上问题SDS结构的优点也显而易见了, 如下: 因为结构体中标记了字符串长度, 所以获取长度的时间复杂度变成了O(1) SDS的API中对内存分配的机制杜绝了缓冲区溢出的问题 同样, API中的操作也减少了修改字符串长度时所需的内存重分配次数 二进制安全 兼容部分C字符串函数 内存分配机制 空间预分配 在字符串增长操作中有两种情况来预分配空间 第一种是修改后的长度(len的值)小于1MB的情况下, free的值会和len的值相同, 来做到减少内存分配次数, 预分配以后可能会使用到的空间 第二种是修改后的长度大于1MB的情况下, free的值会多修改为1MB, 也就是在原来基础上多出1MB的未使用空间 惰性空间释放 在字符串缩短操作的时候, 不会将释放的空间马上回收, 而是会写入到free中, 将缩短的长度标记为未使用空间为将来可能会使用的字符串预留位置。SDS中也有相应的API, 可以在需要时真正释放这部分空间。 </p>
</section>
<footer class=entry-footer><span title="2019-02-26 15:31:32 +0800 CST">February 26, 2019</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to redis中的SDS数据结构" href=https://www.soundpill.cn/posts/2019-02-26-redis%E4%B8%AD%E7%9A%84sds%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>rebase和merge的区别
</h2>
</header>
<section class=entry-content>
<p>变基 找了一大圈, 还是官方的解释最好, 贴出来自己看吧, “变基"这个名字起的很好, 文档中的"重新播放"的解释也相当生动
https://git-scm.com/book/zh/v2/Git-分支-变基</p>
</section>
<footer class=entry-footer><span title="2019-02-24 15:36:37 +0800 CST">February 24, 2019</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to rebase和merge的区别" href=https://www.soundpill.cn/posts/2019-02-24-rebase%E5%92%8Cmerge%E7%9A%84%E5%8C%BA%E5%88%AB/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>cgi, fastcgi, php-cgi, php-fpm的关系
</h2>
</header>
<section class=entry-content>
<p>cgi 通用网关接口, Common Gateway Interface, CGI是Web服务器运行时外部程序的规范, 按CGI编写的程序可以扩展服务器功能. 所以, 广义上的cgi是一种接口标准, 不是字面意义上的接口. 狭义上, cgi就是cgi程序, 运行在服务器上, 提供同客户端HTML页面的接口. 绝大多数的cgi程序被用来解释处理来自表单的输入信息, 并在服务器产生相应的处理, 或将相应的信息反馈给浏览器, cgi程序使网页具有交互功能. cgi程序处理步骤:
通过Internet把用户请求送到web服务器. web服务器接受用户请求并交给CGI程序处理. CGI程序把处理结果传送给web服务器. web服务器把结果送回到用户. fastcgi 快速通用网关接口, Fast Common Gateway Interface, CGI有很多缺点, 每接收一个请求就要fork一个进程处理, 只能接收一个请求作出一个响应, 请求结束后该进程就会结束. 而fastcgi会事先启动起来, 作为一个cgi的管理服务器存在, 使用进程/线程池来处理一连串的请求. fastcgi程序处理步骤:
web服务器启动时载入fastcgi进程管理器 fastcgi自身初始化, 启动多个cgi解释器进程并等待来自web server的请求 当请求来到web服务器时, web服务器通过socket请求fastcgi进程管理器, fastcgi进程管理器选择并连接到一个cgi解释器, web服务器将cgi环境变量和标准输入发送到fastcgi子进程 fastcgi子进程处理请求完成后将标准输出和错误从同一连接返回给web服务器, 当fastcgi子进程结束后请求便结束.fastcgi子进程接着等待处理来自fastcgi进程管理器的下一个连接. php-cgi php实现的cgi程序
php-fpm php实现的fastcgi程序</p>
</section>
<footer class=entry-footer><span title="2019-02-21 15:33:39 +0800 CST">February 21, 2019</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;max</footer>
<a class=entry-link aria-label="post link to cgi, fastcgi, php-cgi, php-fpm的关系" href=https://www.soundpill.cn/posts/2019-02-21-cgi-fastcgi-php-cgi-php-fpm/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=prev href=https://www.soundpill.cn/posts/>« Prev Page</a>
<a class=next href=https://www.soundpill.cn/posts/page/3/>Next Page »</a>
</nav>
</footer>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://www.soundpill.cn/>Beoning</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>